cmake_minimum_required(VERSION 3.0) # Mettez à jour la version minimale si nécessaire

project(TURTLE C)

set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -Wall -std=c99 -O2 -g")

# Recherche des packages Bison et Flex
find_package(BISON)
find_package(FLEX)

# Génération des sources avec Bison et Flex
bison_target(turtle-parser
  turtle-parser.y
  ${CMAKE_CURRENT_BINARY_DIR}/turtle-parser.c
  COMPILE_FLAGS "-v"
)

flex_target(turtle-lexer
  turtle-lexer.l
  ${CMAKE_CURRENT_BINARY_DIR}/turtle-lexer.c
  DEFINES_FILE "${CMAKE_CURRENT_BINARY_DIR}/turtle-lexer.h"
)

add_flex_bison_dependency(turtle-lexer turtle-parser)

# Recherche de SDL2
find_package(SDL2 REQUIRED)
include_directories(${SDL2_INCLUDE_DIRS})

include_directories(${CMAKE_CURRENT_SOURCE_DIR})
include_directories(${CMAKE_CURRENT_BINARY_DIR})

# Ajout de l'exécutable turtle
add_executable(turtle
  turtle.c
  turtle-ast.c
  ${BISON_turtle-parser_OUTPUTS}
  ${FLEX_turtle-lexer_OUTPUTS}
)

# Liaison des bibliothèques mathématiques et SDL2 avec l'exécutable
target_link_libraries(turtle m ${SDL2_LIBRARIES})

target_compile_definitions(turtle
  PRIVATE
    _POSIX_C_SOURCE=200809L
)
